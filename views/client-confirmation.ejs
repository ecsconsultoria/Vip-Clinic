<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agendamento Confirmado - <%= company.name %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="container booking-page">
    <div class="header">
      <h1><%= company.name %></h1>
      <p class="tagline">Agendamento Confirmado! âœ…</p>
    </div>

    <div class="confirmation-box" id="confirmationBox">
      <div class="success-icon">âœ…</div>
      <h2>Seu agendamento foi confirmado!</h2>
      <p>VocÃª receberÃ¡ uma mensagem de confirmaÃ§Ã£o via WhatsApp.</p>
      
      <div class="confirmation-details" id="details"></div>

      <div class="actions">
        <a href="#" id="whatsappBtn" class="btn btn-primary" target="_blank" style="display:none;">
          ğŸ’¬ Abrir ConfirmaÃ§Ã£o no WhatsApp
        </a>
        <a href="#" id="salonBtn" class="btn btn-secondary" target="_blank" style="display:none;">
          ğŸ“± Falar com o SalÃ£o
        </a>
        <a href="/client/booking" class="btn btn-outline">
          ğŸ“… Fazer Novo Agendamento
        </a>
      </div>
    </div>
  </div>

  <script>
    // Obter ID do agendamento da URL
    const appointmentId = '<%= appointmentId %>';
    
    // Buscar detalhes do agendamento
    fetch(`/api/booking/${appointmentId}`)
      .then(res => res.json())
      .then(data => {
        // Formatar data sem problemas de fuso horÃ¡rio
        const [year, month, day] = data.appointment_date.split('-');
        const formattedDate = `${day}/${month}/${year}`;
        
        const detailsHtml = `
          <div class="detail">
            <strong>ğŸ“… Data:</strong> ${formattedDate}
          </div>
          <div class="detail">
            <strong>ğŸ• Hora:</strong> ${data.appointment_time}
          </div>
          <div class="detail">
            <strong>ğŸ’… ServiÃ§o:</strong> ${formatServiceName(data.service)}
          </div>
          <div class="detail">
            <strong>ğŸ’° Valor:</strong> R$ ${(data.service_price || 0).toFixed(2)}
          </div>
          <div class="detail">
            <strong>ğŸ‘¤ Nome:</strong> ${data.client_name}
          </div>
          <div class="detail">
            <strong>ğŸ“± Telefone:</strong> ${data.client_phone}
          </div>
        `;
        
        document.getElementById('details').innerHTML = detailsHtml;
        
        // Gerar link WhatsApp com mensagem prÃ©-formatada
        const whatsappLink = generateWhatsAppLink(data);
        const whatsappBtn = document.getElementById('whatsappBtn');
        whatsappBtn.href = whatsappLink;
        whatsappBtn.style.display = 'inline-block';
        
        // Gerar link para falar com o salÃ£o usando a mesma mensagem
        const salonLink = generateSalonWhatsAppLink(data);
        const salonBtn = document.getElementById('salonBtn');
        salonBtn.href = salonLink;
        salonBtn.style.display = 'inline-block';
      })
      .catch(err => {
        console.error('Erro ao carregar detalhes:', err);
        document.getElementById('details').innerHTML = '<p>Agendamento realizado com sucesso!</p>';
      });

    function formatServiceName(service) {
      const serviceNames = {
        'manicure': 'Manicure',
        'pedicure': 'Pedicure',
        'cilios': 'CÃ­lios',
        'combo_mani_pedi': 'Manicure + Pedicure',
        'combo_completo': 'Manicure + Pedicure + CÃ­lios'
      };
      return serviceNames[service] || service;
    }
    
    function generateWhatsAppLink(data) {
      const serviceName = formatServiceName(data.service);
      const [year, month, day] = data.appointment_date.split('-');
      const formattedDate = `${day}/${month}/${year}`;
      
      const message = `âœ… *MEU AGENDAMENTO*

OlÃ¡! Gostaria de confirmar meu agendamento:

ğŸ’… *ServiÃ§o:* ${serviceName}
ğŸ“… *Data:* ${formattedDate}
ğŸ• *HorÃ¡rio:* ${data.appointment_time}
ğŸ‘¤ *Nome:* ${data.client_name}
ğŸ’° *Valor:* R$ ${(data.service_price || 0).toFixed(2)}

ğŸ†” CÃ³digo: ${data.id}`;
      
      const clientPhone = data.client_phone.replace(/\D/g, '');
      return `https://wa.me/55${clientPhone}?text=${encodeURIComponent(message)}`;
    }
    
    function generateSalonWhatsAppLink(data) {
      const serviceName = formatServiceName(data.service);
      const [year, month, day] = data.appointment_date.split('-');
      const formattedDate = `${day}/${month}/${year}`;
      
      const message = `âœ… *MEU AGENDAMENTO*

OlÃ¡! Gostaria de confirmar meu agendamento:

ğŸ’… *ServiÃ§o:* ${serviceName}
ğŸ“… *Data:* ${formattedDate}
ğŸ• *HorÃ¡rio:* ${data.appointment_time}
ğŸ‘¤ *Nome:* ${data.client_name}
ğŸ’° *Valor:* R$ ${(data.service_price || 0).toFixed(2)}

ğŸ†” CÃ³digo: ${data.id}`;
      
      const salonPhone = '5511961672313'; // Telefone do salÃ£o
      return `https://wa.me/${salonPhone}?text=${encodeURIComponent(message)}`;
    }
  </script>
</body>
</html>
